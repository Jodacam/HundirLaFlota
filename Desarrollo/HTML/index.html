<html lang="es"> 
<head> 
	<meta charset="UTF-8" />
	<title>HLF Online</title>
	<script type="text/javascript" src="../JavaScript/phaser.js"></script>
    <script type="text/javascript" src="../JavaScript/jquery-3.2.1.js"></script>
</head>
<body>
    <script type = "text/javascript">
        "use strict";

        var game = new Phaser.Game(window.innerWidth, window.innerHeight, Phaser.CANVAS, '', { preload: preload, create: create, update: update, render: render});

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        function Celda(x, y) {
            var posX;
            var posY;

            var rect;

            var colorA;
            var colorB;

            this.pintar = function(){
                bmd.rect(rect.x-2, rect.y-2, rect.width+4, rect.height+4, colorB);
                bmd.rect(rect.x+2, rect.y+2, rect.width-4, rect.height-4, colorA);
                bmd.addToWorld();

                /*
                var graphics = game.add.graphics(0, 0);
                graphics.lineStyle(6, colorB, 1);
                graphics.beginFill(colorA);
                graphics.drawRect(rect.x, rect.y, rect.width, rect.height); // coordenada X, coordenada Y, ancho y alto
                graphics.endFill();
                */
            };

            //Getters
            this.getPosX = function(){
                return posX;
            };

            this.getPosY = function(){
                return posY;
            };

            this.getColorA = function(){
                return colorA;
            };

            this.getColorB = function(){
                return colorB;
            };

            this.getRect = function(){
                return rect;
            };

            //Setters
            this.setPosX = function(x){
                posX = x;
            };

            this.setPosY = function(y){
                posY = y;
            };

            this.setColorA = function(a){
                colorA = a;
            };

            this.setColorB = function(b){
                colorB = b;
            };

            this.setRect = function(){
                rect = new Phaser.Rectangle(posX, posY, anchoTablero / 10, anchoTablero / 10);;
            };
        };

        function CeldaA(x, y){
            Celda.call(this, x, y);

            this.setColorA('#0099ff');
            this.setColorB('#FFFFFF');

            var offsetX = (game.width) / 2 + 40;
            var offsetY = (game.height - anchoTablero) / 2;

            this.setPosX(x + offsetX);
            this.setPosY(y + offsetY);

            this.setRect();
        };

        function CeldaE(x, y){
            Celda.call(this, x, y);

            this.setColorA('#00ff99');
            this.setColorB('#000000');

            var offsetX = (game.width - anchoTablero * 2) / 2 - 40;
            var offsetY = (game.height - anchoTablero) / 2;

            this.setPosX(x + offsetX);
            this.setPosY(y + offsetY);

            this.setRect();
        };

        function Barco(imgSrc, nceldas, x, y) {

        };

        function Tablero() {
            var tablero = new Array(10);

            for (var i = 0; i < 10; i++)
                tablero[i] = new Array(10);

            this.pintar = function(i, j){
                for(var i = 0; i < 10; i++){
                    for(var j = 0; j < 10; j++){
                        tablero[i][j].pintar();
                    }
                }
            };

            //Getters
            this.getTablero = function(){
                return tablero;
            };
        };

        function TableroA(){
            Tablero.call(this);

            this.generar = function(){
                for (var i = 0; i < 10; i++){
                    for (var j = 0; j < 10; j++){
                        this.getTablero()[i][j] = new CeldaA(i * anchoTablero / 10, j * anchoTablero / 10);
                    }
                }
            }
        };

        function TableroE(){
            Tablero.call(this);

            this.generar = function(){
                for (var i = 0; i < 10; i++){
                    for (var j = 0; j < 10; j++){
                        this.getTablero()[i][j] = new CeldaE(i * anchoTablero / 10, j * anchoTablero / 10);
                    }
                }
            }
        };

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

        //Herencia
        CeldaA.prototype = new Celda();
        CeldaE.prototype = new Celda();

        TableroA.prototype = new Tablero();
        TableroE.prototype = new Tablero();

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


        var tablero;
        var tablero2;
        var bmd;
        var lienzo;
        var barco;
        //Grupo en el que colocar los barcos para visualizarlos sobre los tableros
        var flota;

        //variable para detectar si se ha clicado
        var clicado = false;

        var anchura = window.innerWidth/2;
        var anchoTablero = anchura*0.7;


        function preload(){
            game.load.image('barco2', 'images/Barco2Solo.png');
            game.load.image('barco3', 'images/Barco3Solo.png');
            game.load.image('barco4', 'images/Barco4Solo.png');
        }

        function create() {
            //Para pintar los rect de las celdas
            bmd = game.add.bitmapData(game.width, game.height);


            flota = game.add.group();

            tablero = new TableroA();
            tablero2 = new TableroE();

            tablero.generar();
            tablero2.generar();

            //creacion de la variable y activacion del movimiento
            barco = game.add.sprite(20, 20, 'barco2');
            barco.inputEnabled = true;
            barco.input.start(0, true);
            barco.events.onInputDown.add(select);

            flota.add(barco);
            
            //codigo para meter los barcos en una variable que los agrupe
           /* for (var i = 0; i < 1; i++) {
                barco = flota.create(20, 20, 'barco2',i);
                barco.inputEnabled = true;
                barco.input.start(0, true);
                barco.events.onInputDown.add(select);
            }*/

            tablero.pintar();
            tablero2.pintar();
            
        }

        function select(barco, pointer) {
            console.log("has clickado el barco");
            clicado = true;
        }

        function update() {
            game.world.bringToTop(flota);
        }

        //si se hace esto en la funcion de update no se renderiza
        function render(){
            if (clicado === true) {
                barco.x = game.input.x - 50;
                barco.y = game.input.y - 30;
            }
        }

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        
    </script>
</body>
</html>