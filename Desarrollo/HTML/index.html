<html lang="es"> 
<head> 
	<meta charset="UTF-8" />
	<title>HLF Online</title>
	<script type="text/javascript" src="../JavaScript/phaser.js"></script>
    <script type="text/javascript" src="../JavaScript/jquery-3.2.1.js"></script>
</head>
<body>
    <script type = "text/javascript">
        "use strict";

        var game = new Phaser.Game(window.innerWidth, window.innerHeight, Phaser.CANVAS, '', { preload: preload, create: create, update: update, render: render});


        var tablero;
        var tablero2;
        var bmd;
        var lienzo;
        var barco;
        var flota;

        //variable para detectar si se ha clicado
        var clicado = false;

        var anchura = window.innerWidth/2;
        var anchoTablero = anchura*0.7;
        

        function preload(){
            game.load.image('barco2', 'images/Barco2Solo.png');
            game.load.image('barco3', 'images/Barco3Solo.png');
            game.load.image('barco4', 'images/Barco4Solo.png');
        }

        function create() {
            flota = game.add.group();
            lienzo = game.add.graphics(0,0);

            tablero = new TableroA();
            tablero2 = new TableroE();

            tablero.generar();
            tablero2.generar();

            //creacion de la variable y activacion del movimiento
            barco = game.add.sprite(20, 20, 'barco2');
            barco.inputEnabled = true;
            barco.input.start(0, true);
            barco.events.onInputDown.add(select);
            
            //codigo para meter los barcos en una variable que los agrupe
           /* for (var i = 0; i < 1; i++) {
                barco = flota.create(20, 20, 'barco2',i);
                barco.inputEnabled = true;
                barco.input.start(0, true);
                barco.events.onInputDown.add(select);
            }*/

            tablero.pintar();
            tablero2.pintar();
            
        }

        function select(barco, pointer) {
            console.log("has clickado el barco");
            clickado = true;
        }

        function update() {

        }

        //si se hace esto en la funcion de update no se renderiza
        function render(){
            if (clicado === true) {
                barco.x = game.input.x - 50;
                barco.y = game.input.y - 30;
            }
        }

        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        function Celda(x, y) {
            this.posX;
            this.posY;

            this.rect;

            this.colorA;
            this.colorB;

            this.pintar = function(){
                var graphics = game.add.graphics(0, 0);
                graphics.lineStyle(6, this.colorB, 1);
                graphics.beginFill(this.colorA);
                graphics.drawRect(this.rect.x, this.rect.y, this.rect.width, this.rect.height); // coordenada X, coordenada Y, ancho y alto
                graphics.endFill();
            }
        };

        function CeldaA(x, y){
            Celda.call(this, x, y);

            this.colorA = 0x0099ff;
            this.colorB = 0xFFFFFF;

            this.offsetX = (game.width) / 2 + 40;
            this.offsetY = (game.height - anchoTablero) / 2;

            this.posX = x + this.offsetX;
            this.posY = y + this.offsetY;

            this.rect = new Phaser.Rectangle(this.posX, this.posY, anchoTablero / 10, anchoTablero / 10);
        };

        function CeldaE(x, y){
            Celda.call(this, x, y);

            this.colorA = 0x00ff99;
            this.colorB = 0x000000;

            this.offsetX = (game.width - anchoTablero * 2) / 2 - 40;
            this.offsetY = (game.height - anchoTablero) / 2;

            this.posX = x + this.offsetX;
            this.posY = y + this.offsetY;

            this.rect = new Phaser.Rectangle(this.posX, this.posY, anchoTablero / 10, anchoTablero / 10);
        };

        function Barco(imgSrc, nceldas, x, y) {

        };

        function Tablero() {
            this.tablero = new Array(10);

            for (var i = 0; i < 10; i++)
                this.tablero[i] = new Array(10);

            this.pintar = function(i, j){
                for(var i = 0; i < 10; i++){
                    for(var j = 0; j < 10; j++){
                        this.tablero[i][j].pintar();
                    }
                }
            }
        };

        function TableroA(){
            Tablero.call(this);

            this.generar = function(){
                for (var i = 0; i < 10; i++){
                    for (var j = 0; j < 10; j++){
                        this.tablero[i][j] = new CeldaA(i * anchoTablero / 10, j * anchoTablero / 10);
                    }
                }
            }
        };

        function TableroE(){
            Tablero.call(this);

            this.generar = function(){
                for (var i = 0; i < 10; i++){
                    for (var j = 0; j < 10; j++){
                        this.tablero[i][j] = new CeldaE(i * anchoTablero / 10, j * anchoTablero / 10);
                    }
                }
            }
        };
    </script>
</body>
</html>